# Extensibility

Bacon ipsum dolor amet jerky jowl meatloaf ribeye beef. Doner chicken bacon tongue picanha
landjaeger pork chop brisket leberkas fatback ball tip meatball corned beef. Drumstick turkey
salami fatback ham hock venison tenderloin pork chop short ribs t-bone beef ribs hamburger
shankle.

Chuck pastrami bresaola salami, pork flank porchetta ground round filet mignon tongue corned
beef. Pork belly spare ribs kielbasa chicken ribeye turducken, jerky pig doner flank.

Hamburger tail landjaeger ball tip, porchetta fatback drumstick kielbasa shankle frankfurter.

Something about Pluggable.CONTINUE...

## bootstrapBundle

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

This Pluggable's definition can be found [here](../src/compile/bundles/bootstrap.js#L9-L20).

## bootstrapBundles

This is an **asynchronous stream plugin**.  This means that the function should
return a stream that emits expected values.

This Pluggable's definition can be found [here](../src/compile/bundles/bootstrap.js#L33).
The function that it wraps can be found [here](../src/compile/bundles/bootstrap.js#L22-L31).

## bootstrapCompilation

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

This Pluggable's definition can be found [here](../src/compile/index.js#L18-L25).

## buildOutput

Given a stream of bundles, reduces those bundles down into a promise that
resolves into a final compilation object.

This compilation object will have three key/value pairs:

- cache:    populated cache from the compilation
- bundles:  a mapping of destination paths to `raw` code
- opts:     the original options passed to the compilation)

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **bundles** | Stream | Bundles generated by [getBundles](#getbundles). |
| Return value |  | Promise | object. |


This Pluggable's definition can be found [here](../src/compile/index.js#L105-L120).

## compile

Performs and end-to-end compilation.  Its return value is a promise
that will resolve to the output of [buildOutput](#buildoutput).

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Return value |  | Promise | Resolves to the compilation output. |


This Pluggable's definition can be found [here](../src/compile/index.js#L128-L134).

## compileModules

This is an **asynchronous stream plugin**.  This means that the function should
return a stream that emits expected values.

This Pluggable's definition can be found [here](../src/compile/modules/compile.js#L18-L120).

## constructBundle

The primary constructor.  Given a set of options, construct Program AST to be emitted
as JavaScript.

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **opts** | Object | Options. |
| Parameter | **opts.includeRuntime** | Boolean | Indicates whether Interlock run-time should be emitted. |
| Parameter | **opts.urls** | Object | Optional. If included, map of module hashes to URLs
will be emitted. |
| Parameter | **opts.modules** | Array | Optional. If included, the module objects will be
transformed into output module AST and emitted. |
| Parameter | **opts.entryModuleHash** | String | Optional. If included, a statement will be rendered
to invoke the specified module on load. |
| Return value |  | ASTnode | program AST node. |


This Pluggable's definition can be found [here](../src/compile/construct/index.js#L164-L167).

## constructBundleBody

Builds body of output bundle, to be inserted into the IIFE.

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **opts** | Object | Same options object passed to constructBundleBody. |
| Return value |  | Array | of bundle. |


This Pluggable's definition can be found [here](../src/compile/construct/index.js#L136-L147).

## constructCommonModule

Given an array of AST nodes and their dependencies (possibly originating from
a common JS module), construct an object expression that represents its run-time
equivalent.

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **moduleBody** | Array | Array of ECMAscript AST nodes. |
| Parameter | **deps** | Array | Array of modules upon which origin module is
dependent. |
| Return value |  | ASTnode | expression AST node. |


This Pluggable's definition can be found [here](../src/compile/construct/index.js#L40-L48).

## constructModuleSet

Given an array of CJS modules (in the form of object expression AST nodes),
construct the AST of a file that would register those modules for consumpsion
by the Interlock run-time.

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **modules** | Array | Array of modules objects. |
| Parameter | **globalName** | String | Global variable name of the Interlock run-time. |
| Return value |  | Array | of AST nodes to be emitted as JavaScript. |


This Pluggable's definition can be found [here](../src/compile/construct/index.js#L60-L78).

## constructRegisterUrls

Transforms a map of module-hashes-to-URLs to the AST equivalent.

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **urls** | Object | Keys are module hashes, values are URL strings. |
| Parameter | **globalName** | String | Global variable name of Interlock run-time. |
| Return value |  | ASTnode | AST node. |


This Pluggable's definition can be found [here](../src/compile/construct/index.js#L118-L127).

## constructRuntime

Construct the guts of the Interlock run-time for inclusion in file output.

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **globalName** | String | Global variable name of Interlock run-time. |
| Return value |  | Array | of AST nodes. |


This Pluggable's definition can be found [here](../src/compile/construct/index.js#L87-L91).

## createModule

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

This Pluggable's definition can be found [here](../src/compile/modules/resolve.js#L4-L16).

## dedupeExplicit

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

This Pluggable's definition can be found [here](../src/compile/bundles/dedupe-explicit.js#L41).
The function that it wraps can be found [here](../src/compile/bundles/dedupe-explicit.js#L5-L39).

## dedupeImplicit

This is an **asynchronous stream plugin**.  This means that the function should
return a stream that emits expected values.

This Pluggable's definition can be found [here](../src/compile/bundles/dedupe-implicit.js#L45).
The function that it wraps can be found [here](../src/compile/bundles/dedupe-implicit.js#L38-L43).

## emitRawBundles

This is an **asynchronous stream plugin**.  This means that the function should
return a stream that emits expected values.

This Pluggable's definition can be found [here](../src/compile/index.js#L68-L89).

## getBundles

This is an **asynchronous stream plugin**.  This means that the function should
return a stream that emits expected values.

This Pluggable's definition can be found [here](../src/compile/index.js#L39-L59).

## getModuleMaps

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

This Pluggable's definition can be found [here](../src/compile/index.js#L27-L37).

## getUrls

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

This Pluggable's definition can be found [here](../src/compile/index.js#L61-L66).

## hashBundle

Calculate the bundle's hash.  Defers to [updateBundleHash](#updatebundlehash) for
the actual calculations.

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **bundle** | Object | Bundle. |
| Return value |  | String | SHA1 that uniquely identifies the bundle. |


This Pluggable's definition can be found [here](../src/compile/bundles/hash.js#L40).
The function that it wraps can be found [here](../src/compile/bundles/hash.js#L27-L38).

## hashModule

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

This Pluggable's definition can be found [here](../src/compile/modules/hash.js#L29).
The function that it wraps can be found [here](../src/compile/modules/hash.js#L19-L27).

## interpolateFilename

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

This Pluggable's definition can be found [here](../src/compile/bundles/interpolate-filename.js#L14).
The function that it wraps can be found [here](../src/compile/bundles/interpolate-filename.js#L3-L12).

## loadModule

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

This Pluggable's definition can be found [here](../src/compile/modules/load.js#L62-L67).

## parseSourceToAst

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

This Pluggable's definition can be found [here](../src/compile/modules/load.js#L16-L36).

## preresolve

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

This Pluggable's definition can be found [here](../src/compile/modules/resolve.js#L18-L20).

## readSource

This function is invoked whenever the compiler attempts to read a source-file
from the disk.  It takes an asset object as its only input.  The properties
available on that asset object are as follows:

- `path` - the absolute path of the file
- `ns` - the namespace of the module (either the default ns, or borrowed from its
containing package)
- `nsRoot` - the absolute path to the root of the namespace
- `nsPath` - the file's path relative to the root of the namespace
- `rawSource` - `null`, this value is provided by the `readSource` function
- `ast` - `null`, this value will be populated later in the compilation
- `requireNodes` - `null`, this value will be populated later in the compilation
- `dependencies` - `null`, this value will be populated later in the compilation
- `hash` - `null`, this value will be populated later in the compilation

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **asset** | Object | Asset object. |
| Return value |  | String | raw source of the file, in string format. |


This Pluggable's definition can be found [here](../src/compile/modules/load.js#L58-L60).

## resolveModule

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

This Pluggable's definition can be found [here](../src/compile/modules/resolve.js#L43).
The function that it wraps can be found [here](../src/compile/modules/resolve.js#L22-L41).

## setLoadEntry

Construct a statement to instruct the runtime to run the specified module.

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **moduleHash** | String | Hash of the module to be required. |
| Parameter | **globalName** | String | Global variable name of Interlock run-time. |
| Return value |  | ASTnode | AST node. |


This Pluggable's definition can be found [here](../src/compile/construct/index.js#L101-L108).

## updateBundleHash

Calculate the bundle's hash by invoking `update` with data from the bundle.
`update` should be called with string data only.

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **update** | Function | Updates the ongoing computation of bundle hash. |
| Parameter | **bundle** | Object | The bundle object. |


This Pluggable's definition can be found [here](../src/compile/bundles/hash.js#L12-L16).

## updateModuleHash

This is an **asynchronous promise plugin**.  This means that the function
should return a promise that resolves to the expected value.

This Pluggable's definition can be found [here](../src/compile/modules/hash.js#L5-L17).

