# Extensibility

Bacon ipsum dolor amet jerky jowl meatloaf ribeye beef. Doner chicken bacon tongue picanha
landjaeger pork chop brisket leberkas fatback ball tip meatball corned beef. Drumstick turkey
salami fatback ham hock venison tenderloin pork chop short ribs t-bone beef ribs hamburger
shankle.

Chuck pastrami bresaola salami, pork flank porchetta ground round filet mignon tongue corned
beef. Pork belly spare ribs kielbasa chicken ribeye turducken, jerky pig doner flank.

Hamburger tail landjaeger ball tip, porchetta fatback drumstick kielbasa shankle frankfurter.

Something about Pluggable.CONTINUE...

## bootstrapCompilation


This Pluggable's definition can be found [here](../src/compile/index.js#L16-L23).

## buildOutput

Given a stream of bundles, reduces those bundles down into a promise that
resolves into a final compilation object.

This compilation object will have three key/value pairs:

- cache:    populated cache from the compilation
- bundles:  a mapping of destination paths to `raw` code
- opts:     the original options passed to the compilation)


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **bundles** | Stream | Bundles generated by [getBundles](#getbundles). |
| Return value |  | Promise | object. |


This Pluggable's definition can be found [here](../src/compile/index.js#L134-L146).

## compile

Performs an end-to-end compilation.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Return value |  | Promise | Resolves to the compilation output. |


This Pluggable's definition can be found [here](../src/compile/index.js#L153-L161).

## compileModules

Given one or more module seeds, traverse their dependency graph, collecting any and
all dependency modules, and then parse, transform, and hash those modules.  Return
a promise that resolves to the full set of modules, once they have been correctly
gathered and compiled.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **moduleSeeds** | Array | Module seeds, i.e. modules that have not yet been
populated with properties such as ast, `dependencies`,
etc.  Module objects _should_ have path, rawSource,
and namespace values. |
| Return value |  | Promise | to array of all compiled modules. |


This Pluggable's definition can be found [here](../src/compile/modules/compile.js#L28-L122).

## constructBundle

The primary constructor.  Given a set of options, construct Program AST to be emitted
as JavaScript.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **opts** | Object | Options. |
| Parameter | **opts.includeRuntime** | Boolean | Indicates whether Interlock run-time should be emitted. |
| Parameter | **opts.urls** | Object | Optional. If included, map of module hashes to URLs
will be emitted. |
| Parameter | **opts.modules** | Array | Optional. If included, the module objects will be
transformed into output module AST and emitted. |
| Parameter | **opts.entryModuleHash** | String | Optional. If included, a statement will be rendered
to invoke the specified module on load. |
| Return value |  | ASTnode | program AST node. |


This Pluggable's definition can be found [here](../src/compile/construct/index.js#L158-L161).

## constructBundleBody

Builds body of output bundle, to be inserted into the IIFE.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **opts** | Object | Same options object passed to constructBundleBody. |
| Return value |  | Array | of bundle. |


This Pluggable's definition can be found [here](../src/compile/construct/index.js#L130-L141).

## constructCommonModule

Given an array of AST nodes and their dependencies (possibly originating from
a common JS module), construct an object expression that represents its run-time
equivalent.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **moduleBody** | Array | Array of ECMAscript AST nodes. |
| Parameter | **deps** | Array | Array of modules upon which origin module is
dependent. |
| Return value |  | ASTnode | expression AST node. |


This Pluggable's definition can be found [here](../src/compile/construct/index.js#L38-L46).

## constructModuleSet

Given an array of CJS modules (in the form of object expression AST nodes),
construct the AST of a file that would register those modules for consumption
by the Interlock run-time.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **modules** | Array | Array of modules objects. |
| Parameter | **globalName** | String | Global variable name of the Interlock run-time. |
| Return value |  | Array | of AST nodes to be emitted as JavaScript. |


This Pluggable's definition can be found [here](../src/compile/construct/index.js#L58-L72).

## constructRegisterUrls

Transforms a map of module-hashes-to-URLs to the AST equivalent.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **urls** | Object | Keys are module hashes, values are URL strings. |
| Parameter | **globalName** | String | Global variable name of Interlock run-time. |
| Return value |  | ASTnode | AST node. |


This Pluggable's definition can be found [here](../src/compile/construct/index.js#L112-L121).

## constructRuntime

Construct the guts of the Interlock run-time for inclusion in file output.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **globalName** | String | Global variable name of Interlock run-time. |
| Return value |  | Array | of AST nodes. |


This Pluggable's definition can be found [here](../src/compile/construct/index.js#L81-L85).

## dedupeExplicit


This Pluggable's definition can be found [here](../src/compile/bundles/dedupe-explicit.js#L32).
The function that it wraps can be found [here](../src/compile/bundles/dedupe-explicit.js#L5-L30).

## dedupeImplicit


This Pluggable's definition can be found [here](../src/compile/bundles/dedupe-implicit.js#L37-L45).

## emitRawBundles


This Pluggable's definition can be found [here](../src/compile/index.js#L84-L118).

## getBundles


This Pluggable's definition can be found [here](../src/compile/index.js#L64-L75).

## getModuleMaps


This Pluggable's definition can be found [here](../src/compile/index.js#L34-L44).

## getSeedBundles


This Pluggable's definition can be found [here](../src/compile/index.js#L55-L62).

## getSeedModules


This Pluggable's definition can be found [here](../src/compile/index.js#L25-L32).

## getUrls


This Pluggable's definition can be found [here](../src/compile/index.js#L77-L82).

## hashBundle

Calculate the bundle's hash.  Defers to [updateBundleHash](#updatebundlehash) for
the actual calculations.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **bundle** | Object | Bundle. |
| Return value |  | String | SHA1 that uniquely identifies the bundle. |


This Pluggable's definition can be found [here](../src/compile/bundles/hash.js#L40).
The function that it wraps can be found [here](../src/compile/bundles/hash.js#L27-L38).

## hashModule

Given a mostly-compiled module, generate a hash for that module and resolve
to that module with a new `hash` property.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **module** | Object | Module that needs to be hashed hash. |
| Return value |  | Object | that now has a hash property. |


This Pluggable's definition can be found [here](../src/compile/modules/hash.js#L42-L51).

## initBundle


This Pluggable's definition can be found [here](../src/compile/index.js#L46-L53).

## interpolateFilename


This Pluggable's definition can be found [here](../src/compile/bundles/interpolate-filename.js#L14).
The function that it wraps can be found [here](../src/compile/bundles/interpolate-filename.js#L3-L12).

## loadModule

Given a module seed, read the module from disk and determine its type.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **module** | Object | Module seed. |
| Return value |  | Object | seed plus `rawSource` and `type` properties. |


This Pluggable's definition can be found [here](../src/compile/modules/load.js#L55-L58).

## parseModule

Parse the source of the provided early-stage module.  Resolves to the same
module with a new `ast` property (or equivalent for non-JavaScript modules).


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **module** | Object | Unparsed module with rawSource property. |
| Return value |  | Object | module with new `ast` property. |


This Pluggable's definition can be found [here](../src/compile/modules/parse.js#L18-L39).

## preresolve

Transform the require string before it is resolved to a file on disk.
No transformations occur by default - the output is the same as the input.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **requireStr** | String | Require string or comparable value. |
| Return value |  | String | require string. |


This Pluggable's definition can be found [here](../src/compile/modules/resolve.js#L13-L15).

## readSource

This function is invoked whenever the compiler attempts to read a source-file
from the disk.  It takes an raw-module object as its only input.  The properties
available on that object are as follows:

- `path` - the absolute path of the file
- `ns` - the namespace of the module (either the default ns, or borrowed from its
containing package)
- `nsRoot` - the absolute path to the root of the namespace
- `nsPath` - the file's path relative to the root of the namespace

The function should output an object with the same properties, plus one additional
property: `rawSource`.  This property should be the string-value of the module
source.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **module** | Object | Module object. |
| Return value |  | Object | object + `rawSource`. |


This Pluggable's definition can be found [here](../src/compile/modules/load.js#L30-L33).

## resolveModule

Given a require string and some context, resolve that require string
to a file on disk, returning a module seed.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **requireStr** | String | Require string or comparable value. |
| Parameter | **contextPath** | String | Absolute path from which to resolve any relative
paths. |
| Parameter | **ns** | String | Namespace to set on module seed if the resolved
module is of the same namespace as its context. |
| Parameter | **nsRoot** | String | Absolute path of default namespace. |
| Parameter | **extensions** | Array | Array of file extension strings, including the leading
dot. |
| Return value |  | Object | seed. |


This Pluggable's definition can be found [here](../src/compile/modules/resolve.js#L53).
The function that it wraps can be found [here](../src/compile/modules/resolve.js#L32-L51).

## setLoadEntry

Construct a statement to instruct the runtime to run the specified module.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **moduleHash** | String | Hash of the module to be required. |
| Parameter | **globalName** | String | Global variable name of Interlock run-time. |
| Return value |  | ASTnode | AST node. |


This Pluggable's definition can be found [here](../src/compile/construct/index.js#L95-L102).

## setModuleType

Given the early-stage module (module seed + rawSource property), determine and set
its type.  This value defaults to "javascript" and is used to determine whether
default behaviors for parsing and processing modules should be used on the module.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **module** | Object | Early-stage module. |
| Return value |  | Object | with new `type` property. |


This Pluggable's definition can be found [here](../src/compile/modules/load.js#L44-L46).

## transformModule

Transforms the module's AST, returning a module object with transformed
`ast` property as well as a new `synchronousRequires` property.  If the
module is not of type "javascript", transformations to type-specific
intermediate representation should occur at this step.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **module** | Object | Module object, with `ast` property. |
| Return value |  | Object | object with transformed `ast` property
and new `synchronousRequires` property. |


This Pluggable's definition can be found [here](../src/compile/modules/transform.js#L18-L57).

## updateBundleHash

Calculate the bundle's hash by invoking `update` with data from the bundle.
`update` should be called with string data only.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **update** | Function | Updates the ongoing computation of bundle hash. |
| Parameter | **bundle** | Object | The bundle object. |


This Pluggable's definition can be found [here](../src/compile/bundles/hash.js#L12-L16).

## updateModuleHash

Use data from the provided module to generate a hash, utilizing the provided
update function.  Only string values should be passed to the update function.
The resulting hash should be deterministic for the same inputs in the same order.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **args** | Object | Wrapper object for update and module. |
| Parameter | **args.module** | Object | Module that needs a hash property. |
| Parameter | **args.update** | Function | Function to be invoked with data that uniquely
identifies the module (or, more precisely, the
run-time behavior of the module). |
| Return value |  | Object | same as the input `args`.  This is so that
chained transformers of this function have easy
access to both the module and the update
function. |


This Pluggable's definition can be found [here](../src/compile/modules/hash.js#L21-L32).

## updateRequires

Give a module whose dependencies have been identified and compiled, replace
all original `require("path/to/dep")` with `require("HASH_OF_DEP")`.


|     | Name | Type | Description |
| --- | ---- | ---- | ----------- |
| Parameter | **module** | Object | Module with AST containing original require expressions. |
| Return value |  | Object | with AST containing require expressions whose
arguments have been replaced with corresponding dependency
module hashes. |


This Pluggable's definition can be found [here](../src/compile/modules/update-requires.js#L16-L37).

